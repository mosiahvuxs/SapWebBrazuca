<ui:composition xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets" 
      xmlns:f="http://xmlns.jcp.org/jsf/core" 
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:p="http://primefaces.org/ui">
	
	<ui:param name="mbean" value="#{conferenciaPdvFaces}"/>
	<ui:param name="mbeanModel" value="#{conferenciaPdvFaces.pedidoVenda}"/>
	<ui:param name="mbeanPesquisaModel" value="#{conferenciaPdvFaces.pedidoVendaPesquisa}"/>
	
	<p:tabView prependId="false">
	
		<p:tab title="Conferência">
			
			<h:form prependId="false">
		
				<br/>
				
				<p:fieldset legend="Filtros" style="width: 97%">
				
					<h:panelGrid columns="2">
						
						<p:fieldset legend="Pedido">
							<h:panelGrid columns="1">
								<p:outputLabel for="numeroPedido" value="Número" style="font-weight: bold;"/>
								<p:inputText style="width: 197px;" id="numeroPedido" value="#{mbeanPesquisaModel.id}" onkeypress="Mascara(this, Integer)" onblur="Mascara(this, Integer)" maxlength="10"/>
							</h:panelGrid>
						</p:fieldset>
						
						<p:fieldset legend="Cliente">
							<h:panelGrid columns="1">
								<p:outputLabel for="cliente" value="Nome:" style="font-weight: bold;"/>
								<p:inputText id="cliente" value="#{mbeanPesquisaModel.cliente.nome}" maxlength="50" style="width: 440px;"/>
							</h:panelGrid>
						</p:fieldset>
					
					</h:panelGrid>
					
					<h:panelGrid columns="3">
					
						<p:fieldset legend="Data de Lançamento">
							
							<h:panelGrid columns="2">
								<p:outputLabel for="dtLacamentoInicial" value="Data Inicial" style="font-weight: bold;"/>
								<p:outputLabel for="dtLacamentoFinal" value="Data Final" style="font-weight: bold;"/>
								<p:calendar navigator="true" readonlyInput="true" id="dtLacamentoInicial" pattern="dd/MM/yyyy" size="15" value="#{mbeanPesquisaModel.dataLancamento}"/>
								<p:calendar navigator="true" readonlyInput="true" id="dtLacamentoFinal" pattern="dd/MM/yyyy" size="15" value="#{mbeanPesquisaModel.dataLancamentoFinal}"/>
							</h:panelGrid>
							
						</p:fieldset>
						
						<p:fieldset legend="Data de Entrega">
							
							<h:panelGrid columns="2">
								<p:outputLabel for="dtEntregaInicial" value="Data Inicial" style="font-weight: bold;"/>
								<p:outputLabel for="dtEntregaFinal" value="Data Final" style="font-weight: bold;"/>
								<p:calendar navigator="true" readonlyInput="true" id="dtEntregaInicial" pattern="dd/MM/yyyy" size="15" value="#{mbeanPesquisaModel.dataVencimento}"/>
								<p:calendar navigator="true" readonlyInput="true" id="dtEntregaFinal" pattern="dd/MM/yyyy" size="15" value="#{mbeanPesquisaModel.dataVencimentoFinal}"/>
							</h:panelGrid>
							
						</p:fieldset>
						
						<p:fieldset legend="Data do Documento">
							
							<h:panelGrid columns="2">
								<p:outputLabel for="dtDocumentoInicial" value="Data Inicial" style="font-weight: bold;"/>
								<p:outputLabel for="dtDocumentoFinal" value="Data Final" style="font-weight: bold;"/>
								<p:calendar navigator="true" readonlyInput="true" id="dtDocumentoInicial" pattern="dd/MM/yyyy" size="15" value="#{mbeanPesquisaModel.dataDocumento}"/>
								<p:calendar navigator="true" readonlyInput="true" id="dtDocumentoFinal" pattern="dd/MM/yyyy" size="15" value="#{mbeanPesquisaModel.dataDocumentoFinal}"/>
							</h:panelGrid>
							
						</p:fieldset>
					
					</h:panelGrid>	
					
				</p:fieldset>
				
				<br/>
				
				<h:panelGrid columns="2">
					<p:commandButton action="#{mbean.pesquisar}" value="Pesquisar" icon="pesquisar" style="height:28px; width: 105px;" update="@form"/>
					<p:commandButton action="#{mbean.limpar}" update="@form" value="Nova Pesquisa" icon="novo" style="height:28px; width: 130px;"/>
				</h:panelGrid>
				
				<br/>
				
				<p:fieldset legend="Resultado" style="width: 97%">

					<p:dataTable var="pdv" id="pdvs" rowIndexVar="index" value="#{mbean.pedidos}" paginator="true" paginatorAlwaysVisible="false" rows="20" emptyMessage="Nenhum P.D.V encontrado">
						<f:facet name="header">
							Pedidos de Venda
						</f:facet>
						<p:column headerText="Conferir" style="width: 20px;">
							<div align="center">
								<p:commandLink onclick="PF('dlgConferencia').show();" type="button">
									<h:graphicImage value="/resources/images/edit.png"/>
									<f:setPropertyActionListener target="#{conferenciaPdvFaces.pedidoVenda}" value="#{pdv}"/>
								</p:commandLink>
							</div>
						</p:column>
						<p:column headerText="Cliente" style="width: 300px;">
							<div align="center">
								<h:outputText value="#{pdv.cliente.nome}" style="font-weight: bold;" />
							</div>
						</p:column>
						<p:column headerText="Nº do Pedido" style="width: 80px;">
							<div align="center">
								<h:outputText value="#{pdv.id}" style="font-weight: bold;" />
							</div>
						</p:column>
						<p:column headerText="Data de Lançamento" style="width: 100px;">
							<div align="center">
								<h:outputText value="#{pdv.dataLancamento}" style="font-weight: bold;">
									<f:convertDateTime type="date" pattern="dd/MM/yyyy" />
								</h:outputText>
							</div>
						</p:column>
						<p:column headerText="Data Documento" style="width: 100px;">
							<div align="center">
								<h:outputText value="#{pdv.dataDocumento}" style="font-weight: bold;">
									<f:convertDateTime type="date" pattern="dd/MM/yyyy" />
								</h:outputText>
							</div>
						</p:column>
						
					</p:dataTable>
					
				</p:fieldset>
				
			</h:form>
			
			<p:dialog focus="formDialog:codigoBarras" onShow="updateForm()" position="center" showEffect="fade" height="500" appendTo="@(body)" header="Conferência de Itens" modal="true" widgetVar="dlgConferencia">
				
				<h:form id="formDialog" onkeydown="if(event.keyCode == 13) setarQuantidadeItens();">
				
				<p:remoteCommand action="#{mbean.pesquisarLinhas}"  name="updateForm" update="@form"/>
				
				<p:remoteCommand id="buttonHidden" name="setarQuantidadeItens" action="#{mbean.setarQuantidadeItens}" update="@form" process="@form"/>
				
				<p:hotkey bind="ESC" handler="PF('dlgConferencia').hide();"/>
				
				<p:hotkey bind="CTRL+B" handler="alert('Deseja realmente salvar ?');"/>
				
				<h:panelGrid columns="4">
					
					<p:outputLabel for="cliente" value="Cliente" style="font-weight: bold;"/>
					<p:outputLabel for="numeroPedidoDl" value="Nº do Pedido" style="font-weight: bold;"/>
					<p:outputLabel for="dtLancamentoDl" value="Data de Lançamento" style="font-weight: bold;"/>
					<p:outputLabel for="dtDocumentoDl" value="Data do Documento" style="font-weight: bold;"/>
					
					<p:inputText readonly="true" id="cliente" value="#{mbeanModel.cliente.nome}" style="width: 250px; font-weight: bold;" tabindex="4"/>
					<p:inputText readonly="true" id="numeroPedidoDl" value="#{mbeanModel.id}" style="font-weight: bold;" tabindex="5"/>
					<p:inputText readonly="true" id="dtLancamentoDl" value="#{mbeanModel.dataLancamento}" style="font-weight: bold;" tabindex="6">
						<f:convertDateTime type="date" pattern="dd/MM/yyyy"/>
					</p:inputText>
					<p:inputText readonly="true" id="dtDocumentoDl" value="#{mbeanModel.dataDocumento}" style="font-weight: bold;" tabindex="7">
						<f:convertDateTime type="date" pattern="dd/MM/yyyy"/>
					</p:inputText>
					
				</h:panelGrid>
				
				<br/>
				
				<h:panelGrid columns="2">
					<p:outputLabel for="codigoBarras" value="Código de Barras" style="font-weight: bold;"/>
					<p:outputLabel for="quantidade" value="Quantidade" style="font-weight: bold;"/>
					<p:inputText id="codigoBarras" style="width: 400px; font-weight: bold;" tabindex="1" value="#{mbean.codigoBarras}"/>
					<p:spinner min="1" value="#{mbean.quantidade}" size="8" maxlength="19" id="quantidade" tabindex="2"/>
				</h:panelGrid>
				
				<br/>
				
				<p:fieldset id="fsItens" legend="Itens do Pedido" style="width: 800px;">
				
					<p:dataTable id="gridItens" paginator="true" paginatorAlwaysVisible="false" rows="10" emptyMessage="Nenhum P.D.V encontrado" value="#{mbeanModel.linhas}" var="linha">
						
						<p:column headerText="Código do Item" styleClass="coluna20">
							<div align="center">
								<h:outputText value="#{linha.item.id}" style="font-weight: bold;"/>
							</div>
						</p:column>
						<p:column headerText="Item" style="width: 300px;">
							<div align="center">
								<h:outputText value="#{linha.item.descricao}" style="font-weight: bold;"/>
							</div>
						</p:column>
						<p:column headerText="Qtd Requisitada" styleClass="coluna10">
							<div align="center">
								<h:outputText value="#{linha.quantidade.intValueExact()}" style="font-weight: bold;"/>
							</div>
						</p:column>
						<p:column headerText="Qtd Liberada" styleClass="coluna10">
							<div align="center">
								<h:outputText value="#{linha.quantidadeLiberada.intValueExact()}" style="font-weight: bold;"/>
							</div>
						</p:column>
						<p:column headerText="Remover" style="width: 50px;">
							<div align="center">
								<p:commandLink type="button" icon="delete16" id="excluir" onclick="PF('cdExcluir').show()" global="false">
									<h:graphicImage value="../resources/images/delete16.png" style="border: 0px" />
									<f:setPropertyActionListener target="#{mbean.pedidoVendaLinha}" value="#{linha}" />
								</p:commandLink>
								
							</div>
						</p:column>
						
					</p:dataTable>
				
				</p:fieldset>
				
				<br/>
				
				<div align="center">
					<h:panelGrid style="margin-left: -2px;" columns="2">
						<p:commandButton id="salvar" value="Salvar" icon="salvar"/>
						<p:commandButton id="sair" type="button" value="Sair" icon="cancelar" onclick="PF('dlgConferencia').hide();"/>
					</h:panelGrid>
				</div>
				
				<p:confirmDialog message="Deseja realmente remover o Item ?" appendTo="@(body)" header="Aviso" severity="alert" widgetVar="cdExcluir">
	    
				    <p:commandButton value="Sim" onclick="PF('cdExcluir').hide();" action="#{mbean.deleteEvent}" update="@form" process="@this" />
				    <p:commandButton value="Não" onclick="PF('cdExcluir').hide();" />
				    
			  	</p:confirmDialog>
				
				</h:form>
					
			</p:dialog>
					
		</p:tab>
		
	</p:tabView>
		
</ui:composition>
